FROM python:3.11-alpine

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

WORKDIR /opt/app

# Copy the lightweight placeholder API implementation.
COPY infrastructure/docker/api_server.py /opt/app/server.py

# Create an unprivileged user to run the service.
RUN adduser -D appuser
USER appuser

EXPOSE 8000

HEALTHCHECK --interval=30s --timeout=5s --start-period=10s --retries=3 \
  CMD wget -qO- http://127.0.0.1:8000/health > /dev/null 2>&1 || exit 1

CMD ["python", "server.py"]
